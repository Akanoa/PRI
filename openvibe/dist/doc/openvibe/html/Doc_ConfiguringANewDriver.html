<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>OpenViBE documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<!-- <link href="tabs.css" rel="stylesheet" type="text/css"> -->
</head>
<body>
<div id="main">
	<div id="title">
		<center>
		<a name="page-top"></a>
		<table width=95%>
			<tr>
				<td><a href="http://openvibe.inria.fr" class="leaving-link" onclick="window.open(this.href,'openvibe-software'); return false;"><img src="logo.png" /></a></td>
				<td width=100%>OpenViBE Documentation</td>
			</tr>
		</table>
		</center>
	</div>
	<div id="menu">
		<div id="menu-content">
			<ul>
				<li><a href="index.html">OpenViBE Documentation</a></li>
			</ul>
			<div class="menu-title">Doxygen</div>
			<ul>
				<!-- <li><a href="pages.html">Related</a></li> -->
				<li><a href="modules.html">Modules</a></li>
				<li><a href="namespaces.html">Namespaces</a></li>
				<li><a href="annotated.html">Class List</a>
				<li><a href="classes.html">Class Index</a>
				<li><a href="hierarchy.html">Class Hierarchy</a>
				<!-- <li><a href="files.html">Files (buggy)</a></li> -->
			</ul>
			<div class="menu-title">Quick Access</div>
			<ul>
				<li><a href="http://openvibe.inria.fr/start" class="leaving-link">Video Tutorials</a></li>
				<li><a href="http://openvibe.inria.fr/faq">FAQ</a></li>
				<li><a href="http://openvibe.inria.fr/license">Licence</a></li>
				<li><a href="http://openvibe.inria.fr/build-instructions/">Build Instructions</a></li>
				<li><a href="http://openvibe.inria.fr/documentation-index/#User+Documentation">User Doc</a></li>
				<li><a href="http://openvibe.inria.fr/documentation-index/#Developer+Documentation">Developer Doc</a></li>
				<li><a href="Doc_BoxAlgorithms.html">Exisiting Boxes</a></li>
			</ul>
			<div class="menu-title">Contact</div>
			<ul>
				<li><a href="http://openvibe.inria.fr" class="leaving-link" onclick="window.open(this.href,'openvibe-software'); return false;">Software Home</a></li>
				<li><a href="http://openvibe.inria.fr/forum" class="leaving-link" onclick="window.open(this.href,'openvibe-forum'); return false;">Forum</a></li>
				<li><a href="https://gforge.inria.fr/projects/openvibe" class="leaving-link" onclick="window.open(this.href,'openvibe-forge'); return false;">INRIA gForge</a></li>
				<li><a href="https://gforge.inria.fr/mail/?group_id=276" class="leaving-link" onclick="window.open(this.href,'openvibe-forge'); return false;">Mailing Lists</a></li>
				<li><a href="http://openvibe.inria.fr/tracker" class="leaving-link" onclick="window.open(this.href,'openvibe-tracker'); return false;">Bug Tracker</a></li>
				<li><a href="http://www.irisa.fr/bunraku/OpenViBE/wiki/index.php?title=Main_Page" class="leaving-link" onclick="window.open(this.href,'openvibe-wiki'); return false;">Research Project</a></li>
				<li><b>IRC</b> : <span style="font-size: x-small; font-style: italic;">#openvibe</span> on <span style="font-size: x-small; font-style: italic;">irc.freenode.net</span></li>
				<li><b>Project Leader</b> : Anatole L&eacute;cuyer, Inria <span style="font-size: x-small; font-style: italic;">(anatole dot lecuyer at inria dot fr)</span></li>
				<li><b>Lead Software Engineer</b> : Laurent Bonnet, Inria <span style="font-size: x-small; font-style: italic;">(laurent dot bonnet at inria dot fr)</span></li>
			</ul>
			<div class="menu-title">Share this</div>
			<ul><li><span style="font-size: x-small; font-style: italic;">This documentation is licenced under <b>CC-BY-SA</b></span></li></ul>
			<td><a href="http://creativecommons.org/licenses/by-sa/3.0/legalcode" class="leaving-link" onclick="window.open(this.href,'cc-by-sa'); return false;"><img src="cc-by-sa.png" /></a></td>
			<br>
			<div class="menu-title">Search</div>
			<form action="search.php" method="get" id="search">
				<fieldset>
					<input class="search" type="text" name="q" value="Quick Search..." onfocus="this.value='';" />
				</fieldset>
			</form>
		</div>
	</div>
	<div class="content-container">
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="Doc_DeveloperDocumentation.html">Developer Documentation</a></li><li class="navelem"><a class="el" href="Doc_DeveloperTutorials.html">Developer tutorials</a></li><li class="navelem"><a class="el" href="Doc_DeveloperDocumentation_Driver.html">Developing a Driver</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: configuring a new driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="important"> This documentation page is deprecated since <a class="el" href="namespaceOpenViBE.html" title="Main OpenViBE namespace.">OpenViBE</a> 0.12.0 (oct 2011), and won't be maintained.  The new documentation page can be found  <a href="http://openvibe.inria.fr/tutorial-configuring-a-new-driver/"> here </a> .</div><ul>
<li><b>NB:</b> Document based on <b> <a class="el" href="namespaceOpenViBE.html" title="Main OpenViBE namespace.">OpenViBE</a> 0.5.0 </b> (18-feb-2010).</li>
</ul>
<h1><a class="anchor" id="Doc_ConfiguringANewDriver_Introduction"></a>
Introduction</h1>
<p>This part of the tutorial will introduce the use of Gtk and Glade, to design the GUI which will be called when the user will ask for the "properties" of your driver.</p>
<p>Gtk is a LGPL toolkit for creating Graphic User Interface (GUI), written in C. Glade is a Rapid Development Tool (RAD) that enables quick and easy development of such user interfaces. Glade saves the GUI as XML, then the OpenViBE acquisition server uses the Gtk Builder to load the interface dynamically as needed.</p>
<p>The Gtk toolkit is already installed with the OpenViBE dependencies, but you have to install Glade on your own (<a href="http://glade.gnome.org/">http://glade.gnome.org/</a>).</p>
<p>The <em>.ui</em> XML files have to be placed in the directory: "\openvibe-applications\acquisition-server\branches[YourBranchDirectory]\share\openvibe-applications\acquisition-server". You will find in this directory several interfaces you may want to start with.</p>
<h1><a class="anchor" id="Doc_ConfiguringANewDriver_TheConfigurationProcess"></a>
The Configuration Process</h1>
<p>The configuration process bring into play 3 entities:</p>
<ul>
<li>The Header</li>
<li>The Driver, which contains a Header object</li>
<li>The Configuration, which one instance is created in the configure(void) function of the driver.</li>
</ul>
<p>The purpose of the configuration process is to fill the Header with user-defined data. The driver creates an instance of the Configuration given a <em>.ui</em> file name, and calls the configure(&amp;IHeader) function on the Header member. The user has to fill in the data in the GUI, then when he presses "Apply", all data stored into the Configuration object will be used to fill the Header.</p>
<p>The basic header contains information about:</p>
<ul>
<li>The subject: identifier, age, gender</li>
<li>The channels: number, names</li>
<li>The acquisition: sampling frequency</li>
</ul>
<p>See <a class="el" href="classOpenViBEAcquisitionServer_1_1IHeader.html" title="Base class for an OpenViBE header container.">OpenViBEAcquisitionServer::IHeader</a> for more details about this header.</p>
<p>The Generic Oscillator driver uses such basic Header. The configuration GUI looks like this: </p>
<div class="image">
<img src="basic_config.png" alt="basic_config.png"/>
<div class="caption">
The basic configuration dialog (interface-Generic-Oscillator.ui)</div></div>
<p> The corresponding configure(void) function in OpenViBEAcquisitionServer::CDriverGenericOscillator is: </p>
<div class="fragment"><div class="line"><span class="keywordtype">boolean</span> CDriverGenericOscillator::configure(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">      <span class="comment">// We use the basic CConfigurationBuilder, with the corresponding .ui file</span></div>
<div class="line">      CConfigurationBuilder m_oConfiguration(<span class="stringliteral">&quot;../share/openvibe-applications/acquisition-server/interface-Generic-Oscillator.ui&quot;</span>);</div>
<div class="line">      <span class="comment">// We configure the Header with it</span></div>
<div class="line">      <span class="keywordflow">return</span> m_oConfiguration.configure(m_oHeader);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Most of the time, driver developers will only use the basic header, but they will need a slightly different configuration. For example, the g.Tec driver handles more than one device connected through USB ports. Besides the basic information, user can select a device in a list of connected devices. </p>
<div class="image">
<img src="gtec_config.png" alt="gtec_config.png"/>
<div class="caption">
The g.Tec configuration dialog (interface-GTec-GUSBamp.ui)</div></div>
<p> The OpenViBEAcquisitionServer::CConfigurationGTecGUSBamp inherits from OpenViBEAcquisitionServer::CConfigurationBuilder, and needs a reference to the variable (member of the driver) which will contains the device USB index selected. Thus, the configure(void) function in the driver looks like this: </p>
<div class="fragment"><div class="line"><span class="keywordtype">boolean</span> CDriverGTecGUSBamp::configure(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">      <span class="comment">// We use a specialized Configuration object that will fill the m_ui32DeviceIndex of the driver with the right value</span></div>
<div class="line">      CConfigurationGTecGUSBamp m_oConfiguration(<span class="stringliteral">&quot;../share/openvibe-applications/acquisition-server/interface-GTec-GUSBamp.ui&quot;</span></div>
<div class="line">                                                              , m_ui32DeviceIndex);</div>
<div class="line">      <span class="comment">// We configure the basic Header</span></div>
<div class="line">      <span class="keywordflow">return</span> m_oConfiguration.configure(m_oHeader);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="Doc_ConfiguringANewDriver_CodingTheConfigurationAndGui"></a>
Coding the Configuration class and designing the GUI with Glade</h1>
<p>The simplest solution is to start from the CConfigurationBuilder class and the interface-Generic-Oscillator.ui file. First of all, think about the basic information that the acquisition client will need. You may want to keep what is related to the subject's information "As is", but the max-min channels number may change depending on the device, so as the allowed sampling frequencies. Tweak the <em>.ui</em> file according to your device.</p>
<p>Then list what your driver will need besides these information: USB port ? Serial port ? Hostname/port to a third party acquisition software ? You will have to translate this into code:</p>
<ul>
<li>Driver class: add new member variables describing these information.</li>
<li>GUI: use Glade to Drag'n'Drop combo-box, spin-button, labels, etc. to make your own GUI.</li>
<li>Configuration class: the CConfigurationBuilder class is probably not enough, implement your own inherited class.</li>
</ul>
<p>Your configuration class will need references to the driver variables, and will redefine the preConfigure(void) and PostConfigure(void) functions of OpenViBEAcquisitionServer::CConfigurationBuilder. See the ovasCConfigurationGTecGUSBamp.h/cpp files for a complete example:</p>
<ul>
<li>preConfigure(void): scan USB ports, fill the gtk-combo-box with available devices <div class="fragment"><div class="line">  <span class="keywordtype">boolean</span> CConfigurationGTecGUSBamp::preConfigure(<span class="keywordtype">void</span>)</div>
<div class="line">  {</div>
<div class="line">        <span class="keywordflow">if</span>(!CConfigurationBuilder::preConfigure())</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ::GtkComboBox* l_pComboBox=GTK_COMBO_BOX(gtk_builder_get_object(m_pBuilderConfigureInterface, <span class="stringliteral">&quot;combobox_device&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">char</span> l_sBuffer[1024];</div>
<div class="line">        <span class="keywordtype">int</span> l_iCount=0;</div>
<div class="line">        <span class="keywordtype">boolean</span> l_bSelected=<span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// autodetection of the connected device</span></div>
<div class="line">        <span class="keywordflow">for</span>(uint32 i=1; i&lt;11; i++)</div>
<div class="line">        {</div>
<div class="line">                ::HANDLE l_pHandle=::GT_OpenDevice(i);</div>
<div class="line">                <span class="keywordflow">if</span>(l_pHandle)</div>
<div class="line">                {</div>
<div class="line">                        ::GT_CloseDevice(&amp;l_pHandle);</div>
<div class="line"> </div>
<div class="line">                        sprintf(l_sBuffer, <span class="stringliteral">&quot;USB port %i&quot;</span>, i);</div>
<div class="line">                        ::gtk_combo_box_append_text(l_pComboBox, l_sBuffer);</div>
<div class="line">                        <span class="keywordflow">if</span>(m_rUSBIndex==i)</div>
<div class="line">                        {</div>
<div class="line">                                ::gtk_combo_box_set_active(l_pComboBox, l_iCount);</div>
<div class="line">                                l_bSelected=<span class="keyword">true</span>;</div>
<div class="line">                        }</div>
<div class="line">                        l_iCount++;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(!l_bSelected &amp;&amp; l_iCount!=0)</div>
<div class="line">        {</div>
<div class="line">                ::gtk_combo_box_set_active(l_pComboBox, 0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">*}</div>
</div><!-- fragment --></li>
<li>postConfigure(void): take the selected device and update the driver reference <div class="fragment"><div class="line">  <span class="keywordtype">boolean</span> CConfigurationGTecGUSBamp::postConfigure(<span class="keywordtype">void</span>)</div>
<div class="line">*{</div>
<div class="line">        ::GtkComboBox* l_pComboBox=GTK_COMBO_BOX(gtk_builder_get_object(m_pBuilderConfigureInterface, <span class="stringliteral">&quot;combobox_device&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(m_bApplyConfiguration)</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordtype">int</span> l_iUSBIndex=0;</div>
<div class="line">                <span class="keywordflow">if</span>(::sscanf(gtk_combo_box_get_active_text(l_pComboBox), <span class="stringliteral">&quot;USB port %i&quot;</span>, &amp;l_iUSBIndex)==1)</div>
<div class="line">                {</div>
<div class="line">                        m_rUSBIndex=(<a class="code" href="namespaceOpenViBE.html#a1134b580f8da4de94ca6b1de4d37975e" title="32 bits unsigned integer">uint32</a>)l_iUSBIndex;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(!CConfigurationBuilder::postConfigure())</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">*}</div>
</div><!-- fragment --></li>
</ul>
<p>Please note the calls to CConfigurationBuilder::preConfigure(void) and CConfigurationBuilder::postConfigure(void), so that basic header information are set.</p>
<h1><a class="anchor" id="Doc_ConfiguringANewDriver_ComplexConfiguration"></a>
Complex configuration</h1>
<p>The previous example may not be enough for a more complex device. For example, the bipolar capacities of the VAmp-16 device needed a specific implementation. If you find your driver hard to configure, feel free to use the forum, IRC or mail. We will help you asap ! </p>
</div></div><!-- contents -->
	</div>
	<div class='clear-both'></div>
	<div id="footer">
		<center>
		<table width=95%>
			<tr>
				<td style="text-align:left;"><a href="#page-top">Back to top</a></td>
				<td style="text-align:right;">Generated on Fri Sep 26 2014 00:47:34 for Documentation by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.1.2</td>
			</tr>
		</table>
		</center>
	</div>
</div>
</body>
</html>
