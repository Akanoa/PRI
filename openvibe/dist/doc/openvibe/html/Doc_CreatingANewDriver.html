<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>OpenViBE documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<!-- <link href="tabs.css" rel="stylesheet" type="text/css"> -->
</head>
<body>
<div id="main">
	<div id="title">
		<center>
		<a name="page-top"></a>
		<table width=95%>
			<tr>
				<td><a href="http://openvibe.inria.fr" class="leaving-link" onclick="window.open(this.href,'openvibe-software'); return false;"><img src="logo.png" /></a></td>
				<td width=100%>OpenViBE Documentation</td>
			</tr>
		</table>
		</center>
	</div>
	<div id="menu">
		<div id="menu-content">
			<ul>
				<li><a href="index.html">OpenViBE Documentation</a></li>
			</ul>
			<div class="menu-title">Doxygen</div>
			<ul>
				<!-- <li><a href="pages.html">Related</a></li> -->
				<li><a href="modules.html">Modules</a></li>
				<li><a href="namespaces.html">Namespaces</a></li>
				<li><a href="annotated.html">Class List</a>
				<li><a href="classes.html">Class Index</a>
				<li><a href="hierarchy.html">Class Hierarchy</a>
				<!-- <li><a href="files.html">Files (buggy)</a></li> -->
			</ul>
			<div class="menu-title">Quick Access</div>
			<ul>
				<li><a href="http://openvibe.inria.fr/start" class="leaving-link">Video Tutorials</a></li>
				<li><a href="http://openvibe.inria.fr/faq">FAQ</a></li>
				<li><a href="http://openvibe.inria.fr/license">Licence</a></li>
				<li><a href="http://openvibe.inria.fr/build-instructions/">Build Instructions</a></li>
				<li><a href="http://openvibe.inria.fr/documentation-index/#User+Documentation">User Doc</a></li>
				<li><a href="http://openvibe.inria.fr/documentation-index/#Developer+Documentation">Developer Doc</a></li>
				<li><a href="Doc_BoxAlgorithms.html">Exisiting Boxes</a></li>
			</ul>
			<div class="menu-title">Contact</div>
			<ul>
				<li><a href="http://openvibe.inria.fr" class="leaving-link" onclick="window.open(this.href,'openvibe-software'); return false;">Software Home</a></li>
				<li><a href="http://openvibe.inria.fr/forum" class="leaving-link" onclick="window.open(this.href,'openvibe-forum'); return false;">Forum</a></li>
				<li><a href="https://gforge.inria.fr/projects/openvibe" class="leaving-link" onclick="window.open(this.href,'openvibe-forge'); return false;">INRIA gForge</a></li>
				<li><a href="https://gforge.inria.fr/mail/?group_id=276" class="leaving-link" onclick="window.open(this.href,'openvibe-forge'); return false;">Mailing Lists</a></li>
				<li><a href="http://openvibe.inria.fr/tracker" class="leaving-link" onclick="window.open(this.href,'openvibe-tracker'); return false;">Bug Tracker</a></li>
				<li><a href="http://www.irisa.fr/bunraku/OpenViBE/wiki/index.php?title=Main_Page" class="leaving-link" onclick="window.open(this.href,'openvibe-wiki'); return false;">Research Project</a></li>
				<li><b>IRC</b> : <span style="font-size: x-small; font-style: italic;">#openvibe</span> on <span style="font-size: x-small; font-style: italic;">irc.freenode.net</span></li>
				<li><b>Project Leader</b> : Anatole L&eacute;cuyer, Inria <span style="font-size: x-small; font-style: italic;">(anatole dot lecuyer at inria dot fr)</span></li>
				<li><b>Lead Software Engineer</b> : Laurent Bonnet, Inria <span style="font-size: x-small; font-style: italic;">(laurent dot bonnet at inria dot fr)</span></li>
			</ul>
			<div class="menu-title">Share this</div>
			<ul><li><span style="font-size: x-small; font-style: italic;">This documentation is licenced under <b>CC-BY-SA</b></span></li></ul>
			<td><a href="http://creativecommons.org/licenses/by-sa/3.0/legalcode" class="leaving-link" onclick="window.open(this.href,'cc-by-sa'); return false;"><img src="cc-by-sa.png" /></a></td>
			<br>
			<div class="menu-title">Search</div>
			<form action="search.php" method="get" id="search">
				<fieldset>
					<input class="search" type="text" name="q" value="Quick Search..." onfocus="this.value='';" />
				</fieldset>
			</form>
		</div>
	</div>
	<div class="content-container">
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="Doc_DeveloperDocumentation.html">Developer Documentation</a></li><li class="navelem"><a class="el" href="Doc_DeveloperTutorials.html">Developer tutorials</a></li><li class="navelem"><a class="el" href="Doc_DeveloperDocumentation_Driver.html">Developing a Driver</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: creating a new driver for the acquisition server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="important"> This documentation page is deprecated since <a class="el" href="namespaceOpenViBE.html" title="Main OpenViBE namespace.">OpenViBE</a> 0.12.0 (oct 2011), and won't be maintained.  The new page can be found  <a href="http://openvibe.inria.fr/tutorial-creating-a-new-driver-for-the-acquisition-server/"> here </a> .</div><ul>
<li><b>NB:</b> Document based on <b> <a class="el" href="namespaceOpenViBE.html" title="Main OpenViBE namespace.">OpenViBE</a> 0.8.0 </b> (30-sept-2010).</li>
</ul>
<h1><a class="anchor" id="Doc_CreatingANewDriver_Introduction"></a>
Introduction</h1>
<p>This page is intended to driver developers and shows how to create a new acquisition driver for the OpenViBE acquisition server. The driver is a single object that interacts with the hardware acquisition peripheral and formats acquired measures and information in a way the acquisition server understands. Once the acquisition server receives measures and information, it is able to send them to the multiple connected clients.</p>
<p>The connection between the hardware and the driver does not really matters to the acquisition server. Some hardware manufacturer will provide an API so that the driver has direct access to the peripheral through physical connection (maybe USB, serial port or so). Some will provide a proprietary acquisition server, which allows connections through TCP/IP to stream the measures in real time. Whatever your hardware manufacturer provides, the OpenViBE driver is in charge of collecting a set of information / measures and to format all of them according to the format of OpenViBE.</p>
<h1><a class="anchor" id="Doc_CreatingANewDriver_HowIsTheDriverUsed"></a>
How is the driver used ?</h1>
<p>First, the driver has to give a name to the acquisition server. This will be used in the acquisition server GUI to easily identify the hardware the user is working with. This is why you should give a precise name to the driver, using for example, the hardware manufacturer name and the hardware model name.</p>
<p>The driver essentially deals with two kinds of data :</p>
<ul>
<li>the header</li>
<li>the buffer</li>
</ul>
<p>The header is the part of data that does not change along time, containing several identifiers about the experiment being done, information about the channels being acquired and so on. See <a class="el" href="classOpenViBEAcquisitionServer_1_1IHeader.html" title="Base class for an OpenViBE header container.">OpenViBEAcquisitionServer::IHeader</a> for more details about this header.</p>
<p>The buffer is the part of data that changes along time. It contains the different samples for each channel on a given time period which depend on the number of samples per sent channel. This value is given to the driver during the initialization phase.</p>
<p>To deal with these data, the driver is used by the acquisition server at different stages of the execution. The three most important are :</p>
<ul>
<li>configuration</li>
<li>intialization / uninitialization</li>
<li>acquisition</li>
</ul>
<p>The configuration stage can be used by the driver to request the header's information that won't be available from the hardware. Depending on the hardware, all the information for the header may be found in the streamed data, resulting in an non-configurable driver (may be easier for the acquisition server user). For example, a driver with physical connection may not provide subject age or sex. Such a driver will need a configuration phase before it can be used.</p>
<p>In the intialization stage, the driver requests readyness status to the hardware. Once the driver is initialized (this means <a class="el" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a75d51791e8980af2ef1cad2fd9d9c076" title="Initializes the driver.">OpenViBEAcquisitionServer::IDriver::initialize</a> returns), the driver should have a complete header ready to be sent to the acquisition server. The driver's <a class="el" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a4c56d615528913d900acecb25af8f2be" title="Requests data acquisition to be done.">OpenViBEAcquisitionServer::IDriver::loop</a> is regularly called so that the driver may be able to keep the connection to the device alive, of can he drop some data if needed.</p>
<p>The acquisition stage comes when <a class="el" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a31a90fda4ec72f2d945f26b09f4a0089" title="Starts acquisition for this driver.">OpenViBEAcquisitionServer::IDriver::start</a> is called. From this stage, the driver is regularly requested to provide new data within the <a class="el" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a4c56d615528913d900acecb25af8f2be" title="Requests data acquisition to be done.">OpenViBEAcquisitionServer::IDriver::loop</a> function.</p>
<p>A schematic representation of the automate for a driver is here below :</p>
<div class="image">
<img src="driver_automate.png" alt="driver_automate.png"/>
<div class="caption">
The driver automate</div></div>
<p> Now that you know what a driver is, we shall start coding it. We provide a developer tool named <b>Skeleton-generator</b>, that generates for you all the files you will need to build the driver.</p>
<h1><a class="anchor" id="Doc_CreatingANewDriver_SkeletonGenerator"></a>
Using the Skeleton-Generator</h1>
<p>The Skeleton-generator needs the following information :</p>
<ul>
<li>Author name</li>
<li>Company/Affiliation</li>
<li>Driver name</li>
<li>Class name</li>
<li>Min &amp; Max channel count</li>
<li>Sampling frequencies</li>
<li>Directory where the files will be generated</li>
</ul>
<p>And will generates the following files :</p>
<ul>
<li>the driver class code (.h and .cpp)</li>
<li>the configuration class code (.h and .cpp)</li>
<li>the GtkBuilder interface file (.ui)</li>
<li>a readme.txt file that explains how to use the generated files.</li>
</ul>
<div class="image">
<img src="skeleton-generator.png" alt="skeleton-generator.png"/>
<div class="caption">
The skeleton generator GUI</div></div>
<p> Each field has its own conditions, use the "Help" buttons for detailed examples. Once all fields are filled, you must check it by pressing the dedicated button. A report will be displayed, asking you to modify the wrong fields if any. If everything is good, you can press the button "OK" to generate the files. Let's take a closer look at the skeletons now.</p>
<h1><a class="anchor" id="Doc_CreatingANewDriver_CodingTheDriver"></a>
Coding the driver</h1>
<p>Coding the driver consists in implementing an <a class="el" href="classOpenViBEAcquisitionServer_1_1IDriver.html" title="Base class for all the OpenViBE acquisition server drivers.">OpenViBEAcquisitionServer::IDriver</a> object.</p>
<p>Here comes the driver skeleton generated.</p>
<h2><a class="anchor" id="Doc_CreatingANewDriver_CodingTheDriver_Header"></a>
The header</h2>
<p>The header would look like this :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../ovasIDriver.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../ovasCHeader.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;openvibe/ov_all.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>OpenViBEAcquisitionServer</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">class </span>CDriverTestSkGenerator : <span class="keyword">public</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html" title="Base class for all the OpenViBE acquisition server drivers.">OpenViBEAcquisitionServer::IDriver</a></div>
<div class="line">        {</div>
<div class="line">        <span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">                CDriverTestSkGenerator(OpenViBEAcquisitionServer</div>
<div class="line">                                ::IDriverContext&amp; rDriverContext);</div>
<div class="line">                <span class="keyword">virtual</span> ~CDriverTestSkGenerator(<span class="keywordtype">void</span>);</div>
<div class="line">                <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* getName(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> initialize(</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="namespaceOpenViBE.html#a1134b580f8da4de94ca6b1de4d37975e" title="32 bits unsigned integer">OpenViBE::uint32</a> ui32SampleCountPerSentBlock,</div>
<div class="line">                        <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriverCallback.html" title="Base class for all the OpenViBE acquisition server driver callbacks.">OpenViBEAcquisitionServer::IDriverCallback</a>&amp; rCallback);</div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> uninitialize(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> start(<span class="keywordtype">void</span>);</div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> stop(<span class="keywordtype">void</span>);</div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> loop(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> isConfigurable(<span class="keywordtype">void</span>);</div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> configure(<span class="keywordtype">void</span>);</div>
<div class="line">                <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IHeader.html" title="Base class for an OpenViBE header container.">OpenViBEAcquisitionServer::IHeader</a>* getHeader(<span class="keywordtype">void</span>) </div>
<div class="line">                { </div>
<div class="line">                        <span class="keywordflow">return</span> &amp;m_oHeader; </div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">                <span class="keyword">virtual</span> <a class="code" href="namespaceOpenViBE.html#af29b166bf5fea7f0bbc07f7014a8c6b5" title="Boolean.">OpenViBE::boolean</a> isFlagSet(</div>
<div class="line">                        <span class="keyword">const</span> OpenViBEAcquisitionServer::EDriverFlag eFlag)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">                </span>{</div>
<div class="line">                        <span class="keywordflow">return</span> eFlag==DriverFlag_IsUnstable;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span>:</div>
<div class="line"></div>
<div class="line">                <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriverCallback.html" title="Base class for all the OpenViBE acquisition server driver callbacks.">OpenViBEAcquisitionServer::IDriverCallback</a>* m_pCallback;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Replace this generic Header with any specific </span></div>
<div class="line">                <span class="comment">// header you might have written</span></div>
<div class="line">                OpenViBEAcquisitionServer::CHeader m_oHeader;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="namespaceOpenViBE.html#a1134b580f8da4de94ca6b1de4d37975e" title="32 bits unsigned integer">OpenViBE::uint32</a> m_ui32SampleCountPerSentBlock;</div>
<div class="line">                <a class="code" href="namespaceOpenViBE.html#aacdc525d6f7bddb3ae95d5c311bd06a1" title="32 bits floating point">OpenViBE::float32</a>* m_pSample;</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Insert here all specific attributes, such as USB port </span></div>
<div class="line"><span class="comment">                 * number or device ID.</span></div>
<div class="line"><span class="comment">                 * Example :</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="comment">// OpenViBE::uint32 m_ui32USBPort;</span></div>
<div class="line">        };</div>
<div class="line">};</div>
</div><!-- fragment --><p>We will now describe in details the implementation of these functions. The implementation can be divided in 3 phases : the preliminary, the configuration, the acquisition.</p>
<h2><a class="anchor" id="Doc_CreatingANewDriver_CodingTheDriver_Preliminary"></a>
Preliminary</h2>
<p>The first part of the cpp file contains the constructor, the destructor and the getName function. The code is relatively simple and speaks for itself. </p>
<div class="fragment"><div class="line">CDriverTestSkGenerator::CDriverTestSkGenerator(IDriverContext&amp; rDriverContext)</div>
<div class="line">        :IDriver(rDriverContext)</div>
<div class="line">        ,m_pCallback(NULL)</div>
<div class="line">        ,m_ui32SampleCountPerSentBlock(0)</div>
<div class="line">        ,m_pSample(NULL)</div>
<div class="line">{</div>
<div class="line">        m_oHeader.setSamplingFrequency(128);</div>
<div class="line">        m_oHeader.setChannelCount(4);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">CDriverTestSkGenerator::~CDriverTestSkGenerator(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#abd73e30a754783f800b8a277bfb21711" title="Gets the driver name (usually the hardware name)">CDriverTestSkGenerator::getName</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Simple test driver (p1)&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="Doc_CreatingANewDriver_CodingTheDriver_Configuration"></a>
Configuration</h2>
<p>The configuration phase calls the dedicated GUI. The CConfiguration object fills the header with information from the GUI : subject identifier, number of channel, channel names, sampling frequency etc. </p>
<div class="fragment"><div class="line"> <span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#ace135032494e789c94e2dfaa82aff2ba" title="This function should tell whether the dirver is configurable or not.">CDriverTestSkGenerator::isConfigurable</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// change to false if your device is not configurable</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a27f764106cd6f6d0b215591981d5c20c" title="Requests the driver to configure itself.">CDriverTestSkGenerator::configure</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        CConfigurationTestSkGenerator m_oConfiguration(m_rDriverContext,</div>
<div class="line">                        <span class="stringliteral">&quot;../share/openvibe-applications/acquisition-server/interface-TestSkGenerator.ui&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span>(!m_oConfiguration.configure(m_oHeader))</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="Doc_CreatingANewDriver_CodingTheDriver_Acquisition"></a>
Acquisition</h2>
<p>To acquire the data, we must firstly initialize the driver. The <em>initialize</em> function will be called by the acquisition server with a given callback, to be feeded with samples. If the hardware needs initialization, put the dedicated code in this function. The <em>uninitialize</em> function desallocate properly everything. </p>
<div class="fragment"><div class="line"> <span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a75d51791e8980af2ef1cad2fd9d9c076" title="Initializes the driver.">CDriverTestSkGenerator::initialize</a>(</div>
<div class="line">        <span class="keyword">const</span> uint32 ui32SampleCountPerSentBlock,</div>
<div class="line">        IDriverCallback&amp; rCallback)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(m_rDriverContext.isConnected()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(!m_oHeader.isChannelCountSet()</div>
<div class="line">                ||!m_oHeader.isSamplingFrequencySet()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Builds up a buffer to store</span></div>
<div class="line">        <span class="comment">// acquired samples. This buffer</span></div>
<div class="line">        <span class="comment">// will be sent to the acquisition</span></div>
<div class="line">        <span class="comment">// server later...</span></div>
<div class="line">        m_pSample=<span class="keyword">new</span> <a class="code" href="namespaceOpenViBE.html#aacdc525d6f7bddb3ae95d5c311bd06a1" title="32 bits floating point">float32</a>[m_oHeader.getChannelCount()</div>
<div class="line">                        *ui32SampleCountPerSentBlock];</div>
<div class="line">        <span class="keywordflow">if</span>(!m_pSample)</div>
<div class="line">        {</div>
<div class="line">                <span class="keyword">delete</span> [] m_pSample;</div>
<div class="line">                m_pSample=NULL;</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// initialize hardware and get</span></div>
<div class="line">        <span class="comment">// available header information</span></div>
<div class="line">        <span class="comment">// from it</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Saves parameters</span></div>
<div class="line">        m_pCallback=&amp;rCallback;</div>
<div class="line">        m_ui32SampleCountPerSentBlock=ui32SampleCountPerSentBlock;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#addb3e86e8e097bbe3964e82aa104225f" title="Uninitializes the driver.">CDriverTestSkGenerator::uninitialize</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isConnected()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(m_rDriverContext.isStarted()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// uninitialize hardware here</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">        <span class="keyword">delete</span> [] m_pSample;</div>
<div class="line">        m_pSample=NULL;</div>
<div class="line">        m_pCallback=NULL;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Once the driver is initialized, the acquisition can start. The <em>start</em> and <em>stop</em> functions handle the connection and ask the hardware to start/stop sending the EEG data.</p>
<div class="fragment"><div class="line"><span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a31a90fda4ec72f2d945f26b09f4a0089" title="Starts acquisition for this driver.">CDriverTestSkGenerator::start</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isConnected()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(m_rDriverContext.isStarted()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// request hardware to start</span></div>
<div class="line">        <span class="comment">// sending data</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#ab32aa113528102b255367e9fbd2643ab" title="Stops acquisition for this driver.">CDriverTestSkGenerator::stop</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isConnected()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isStarted()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// request the hardware to stop</span></div>
<div class="line">        <span class="comment">// sending data</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, the <em>loop</em> function reads the data and stores it in a buffer. This function is called as fast as possible by the acquisition server once the driver is connected (intialized).</p>
<div class="fragment"><div class="line"><span class="keywordtype">boolean</span> <a class="code" href="classOpenViBEAcquisitionServer_1_1IDriver.html#a4c56d615528913d900acecb25af8f2be" title="Requests data acquisition to be done.">CDriverTestSkGenerator::loop</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isConnected()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(!m_rDriverContext.isStarted()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classOpenViBE_1_1CStimulationSet.html" title="Basic standalone OpenViBE stimulation set implementationThis class offers a basic standalone impement...">OpenViBE::CStimulationSet</a> l_oStimulationSet;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// receive samples from hardware</span></div>
<div class="line">        <span class="comment">// put them the correct way in the sample array</span></div>
<div class="line">        <span class="comment">// whether the buffer is full, send it to the acquisition server</span></div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        m_pCallback-&gt;setSamples(m_pSample);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// receive events from hardware</span></div>
<div class="line">        <span class="comment">// and put them the correct way in a CStimulationSet object</span></div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        m_pCallback-&gt;setStimulationSet(l_oStimulationSet);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>For a simple working example of driver, please take a look to the generic oscillator. This driver does not connect to any hardware. Instead, it produces the samples itself using sinusoidal signal. This can easily be tuned to match your needs for any specific driver and also could be used to test your OpenViBE platform.</p>
<h1><a class="anchor" id="Doc_CreatingANewDriver_UsingTheNewDriver"></a>
Using the driver</h1>
<p>When you have a working driver you probably want to test / use it. In order to achieve this task, you have to register the driver to the acquisition server. Put your .h / .cpp files in the acquisition server project : <em>openvibe-applications/acquisition-server/trunc/src/<b>your-driver-name</b></em> Then edit the main acquisition server file <em>ovasCAcquisitionServerGUI.cpp</em> and add your driver in the driver list.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;your-driver-name/ovasCDriverYourDriverName.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">CAcquisitionServer::CAcquisitionServer(<span class="keyword">const</span> <a class="code" href="classOpenViBE_1_1Kernel_1_1IKernelContext.html" title="Kernel context interface, gives access to each manager the kernel owns.">OpenViBE::Kernel::IKernelContext</a>&amp; rKernelContext)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">  m_vDriver.push_back(<span class="keyword">new</span> CDriverYourDriverName(*m_pDriverContext));</div>
<div class="line"></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>If you used the skeleton-generator, please look at the <b>readme</b> file for further details.</p>
<h1><a class="anchor" id="Doc_CreatingANewDriver_More"></a>
Advanced developments</h1>
<p>Your driver may be functionnal, but not complete. You should be able to connect it and start it in the Acquisition Server, however more developments are possible to improve your driver. The following tutotials will help you with more advanced developments:</p>
<ul>
<li><a class="el" href="Doc_ConfiguringANewDriver.html">Tutorial: configuring a new driver</a> : how to set up a dedicated GUI so the user can configure the driver.</li>
<li><a class="el" href="Doc_DriverImpedanceChecker.html">Tutorial: Using the built-in Impedance Checker</a> : how to use the given impedance checker mechanism, if your device is capable of.</li>
<li><a class="el" href="Doc_DriverJitterCorrection.html">Tutorial: Jitter monitoring and drift correction</a> : the acquisition is somehow drifting from its theorical sampling rate ? Correct it with jitter monitoring and drift correction. </li>
</ul>
<h1><a class="anchor" id="Doc_CreatingANewDriver_Support"></a>
Support</h1>
<p>In case you have problem in developing the driver, feel free to contact experienced OpenViBE developers on the mailing lists, forums or IRC channels. Visit OpenViBE homepage to get up to date places where you can ask for help...</p>
<p>Enjoy OpenViBE ! </p>
</div></div><!-- contents -->
	</div>
	<div class='clear-both'></div>
	<div id="footer">
		<center>
		<table width=95%>
			<tr>
				<td style="text-align:left;"><a href="#page-top">Back to top</a></td>
				<td style="text-align:right;">Generated on Fri Sep 26 2014 00:47:34 for Documentation by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.1.2</td>
			</tr>
		</table>
		</center>
	</div>
</div>
</body>
</html>
